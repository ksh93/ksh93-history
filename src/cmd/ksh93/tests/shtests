# This program runs ksh regression tests

unset ENV FIGNORE LANG LC_ALL
export PATH PWD SHELL
PWD=`pwd`
SHELL=${SHELL-ksh}
case $0 in
/*)	d=`dirname $0`;;
*/*)	d=$PWD/`dirname $0`;;
*)	d=$PWD;;
esac
case $SHELL in
/*)	;;
*/*)	SHELL=$d/$SHELL;;
*)	SHELL=$(whence $SHELL);;
esac
PATH=/bin:/usr/bin
if	[[ -d /usr/ucb ]]
then	PATH=$PATH:/usr/ucb
fi
PATH=$PATH:$d
if [[ $INSTALLROOT && -r $INSTALLROOT/bin/.paths ]]
then	PATH=$INSTALLROOT/bin:$PATH
fi
for i in ${*-*.sh}
do	echo test $i begins at `date`
	t=$(grep -c err_exit $i)
	if	(( $t ))
	then	(( t = $t - 1 ))
	fi
	T=test
	if	(( $t != 1 ))
	then	T=${T}s
	fi
	E=error
	if	$SHELL $i
	then	echo test $i passed at `date` "[ $t $T 0 ${E}s ]"
	else	e=$?
		E=error
		if	(( $e != 1 ))
		then	E=${E}s
		fi
		echo test $i failed at `date` with exit code $e "[ $t $T $e $E ]"
	fi
done
